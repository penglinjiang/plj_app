一、TCP协议的长连接和短连接
  1.必须申明的误区：HTTP协议是基于“请求/响应”模式的，因此服务端收到客户端的请求并给出了响应，本次HTTP连接就算结束了。或者跟准确的说是本次HTTP请求就结束了。
    HTTP是没有长连接短连接的说法的。所以在网络上说HTTP分为长连接和短连接实质上是指TCP的长链接和短连接，TCP才是真正的传输层协议，只有负责传输层的协议才需要建立连接。

  

  2.TCP连接：当网络通信采用TCP协议时，在真正的读写操作之前，server和client之间必须先建立一个连接，当读写操作执行完成之后，双方都不需要这个连接时可以选择释放这个连接。
    而建立连接需要三次握手，释放连接需要四次握手，所以每次建立连接和释放连接都是需要消耗资源的。至于三次握手和四次握手自行查阅。这里回答两个问题：
      a.为什么连接需要三次握手而关闭却需要四次：因为当server收到client的SYN连接请求的报文后，可以直接发送SYN+ACK报文，ACK报文用于响应，而SYN报文用于同步。但是释放连接时，server收到client的
        FIN请求关闭连接报文，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉client端：“你发的FIN报文我已经收到了，等我server端所有的报文抖发送完了我才能发送FIN报文给你”，因此需要
        四次握手。

  3.TCP短连接：client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client
    先发起close操作。为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。从上面的描述看，短连接一般只会在client/server间传递一次读写操作

  4.TCP长连接：client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。

  5.TCP长连接保活功能：保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，
    则服务器将永远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。
    如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：
       a.客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。
       b.客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。
       c.客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。
       d.客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。
  6.关于几个问题的解答：
    a.HTTP中是否只要设置了Connection为keep-alive就算是长连接了？
      答：是的，但是得服务端和客户端都得支持并且同时设置
    b.我们平时用的web是不是长连接？
      答：基本是的，现在使用的基本都是HTTP1.1协议，基本上Connection都为keep-alive，HTTP协议文档液体到了，HTTP1.1默认使用长连接，就是默认使用Connection=keep-alive就算是长连接了？
    c.长连接是适合于频繁交互而又并发量不是特别大的应用，普通的Web应用为什么要用长连接？
      答：长连接是为了复用，比如你请求了博客园的一个网页，这个网页里肯定还包含了CSS、JS等等一系列资源，如果你是短连接（也就是每次都要重新建立TCP连接）的话，那你每打开一个网页，基本要建立几个甚至几十个TCP连接，
         这浪费了资源去建立连接和释放连接。而如果使用长连接，多个HTTP请求可以复用同一个TCP连接，这就节省了很多TCP连接建立和断开的消耗。